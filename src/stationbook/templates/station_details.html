{% extends 'base.html' %}
{% load static %}

{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/ol.css' %}" type="text/css">
<style>
  .map {
    height: 300px;
    width: 100%;
  }
</style>
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'networks' %}">Networks</a></li>
<li class="breadcrumb-item"><a href="{% url 'network_details' station.fdsnStation_fdsnNetwork.code %}">{{ station.fdsnStation_fdsnNetwork.code }}</a></li>
<li class="breadcrumb-item active">{{ station.code }}</li>
{% endblock %}

{% block content %}
<div id="map" class="map">
    <div id="popup"></div>
</div>

<div class="btn-group mt-2 mb-2 float-right" role="group" aria-label="Button group with nested dropdown">
    <button type="button" class="btn btn-light">Station gallery</button>

    {% if user.is_authenticated %}
    <div class="btn-group" role="group">
        <button id="btnGroupDrop1" type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">Edit station data</button>
        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
            <a class="dropdown-item" href="{% url 'station_edit_basic' station.fdsnStation_fdsnNetwork.code station.code %}">Edit basic station data</a>
            <a class="dropdown-item" href="{% url 'station_edit_owner' station.fdsnStation_fdsnNetwork.code station.code %}">Edit owner station data</a>
            <a class="dropdown-item" href="{% url 'station_edit_morphology' station.fdsnStation_fdsnNetwork.code station.code %}">Edit morphology station data</a>
            <a class="dropdown-item" href="{% url 'station_edit_housing' station.fdsnStation_fdsnNetwork.code station.code %}">Edit housing station data</a>
        </div>
    </div>
    {% endif %}

    <div class="btn-group" role="group">
        <button id="btnGroupDrop1" type="button" class="btn btn-light dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false">Export</button>
        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
            <a class="dropdown-item" href="#">Export to PDF</a>
            <a class="dropdown-item" href="#">Export to HTML</a>
            <a class="dropdown-item" href="#">Export to CSV</a>
        </div>
    </div>
</div>

<div class="table-responsive">
<p><h3>FDSNWS-Station Data:</h3></p>
<table class="table table-sm">
    <thead class="thead-inverse">
        <tr>
            <th>Network</th>
            <th>Code</th>
            <th>Name</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Elevation [m]</th>
            <th>Status</th>
            <th>Start</th>
            <th>Created</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ station.fdsnStation_fdsnNetwork.code }}</td>
            <td>{{ station.code }}</td>
            <td>{{ station.site_name }}</td>
            <td>{{ station.latitude }}</td>
            <td>{{ station.longitude }}</td>
            <td>{{ station.elevation }}</td>
            <td>{{ station.restricted_status }}</td>
            <td>{{ station.start_date }}</td>
            <td>{{ station.creation_date }}</td>
        </tr>
    </tbody>
</table>
{% if user.is_authenticated %}
<p class="text-muted float-right">FDSNWS-Station data cannot be edited</p>
{% endif %}
</div>

<div class="table-responsive">
<p><h3>Basic Data:</h3></p>
<table class="table table-sm">
    <thead class="thead-inverse">
        <tr>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ station.ext_basic_data.get_description_as_markdown }}</td>
        </tr>
    </tbody>
</table>
<table class="table table-sm">
    <thead class="thead-inverse">
        <tr>
            <th>Start</th>
            <th>End</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ station.ext_basic_data.start }}</td>
            <td>{{ station.ext_basic_data.end }}</td>
        </tr>
    </tbody>
</table>
</div>

<div class="table-responsive">
<p><h3>Owner Data:</h3></p>
<table class="table table-sm">
    <thead class="thead-inverse">
        <tr>
            <th>Name</th>
            <th>Department</th>
            <th>Agency</th>
            <th>Street</th>
            <th>Country</th>
            <th>Phone</th>
            <th>Email</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ station.ext_owner_data.name }}</td>
            <td>{{ station.ext_owner_data.department }}</td>
            <td>{{ station.ext_owner_data.agency }}</td>
            <td>{{ station.ext_owner_data.street }}</td>
            <td>{{ station.ext_owner_data.country }}</td>
            <td>{{ station.ext_owner_data.phone }}</td>
            <td>{{ station.ext_owner_data.email }}</td>
        </tr>
    </tbody>
</table>
</div>

<div class="table-responsive">
<p><h3>Morphology Data:</h3></p>
<table class="table table-sm">
    <thead class="thead-inverse">
        <tr>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ station.ext_morphology_data.get_description_as_markdown }}</td>
        </tr>
    </tbody>
</table>
</div>

<div class="table-responsive">
<p><h3>Housing Data:</h3></p>
<table class="table table-sm">
    <thead class="thead-inverse">
        <tr>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>{{ station.ext_housing_data.get_description_as_markdown }}</td>
        </tr>
    </tbody>
</table>
</div>

<script src="{% static 'js/ol.js' %}"></script>
<script src="{% static 'js/home_openlayers.js' %}"></script>

<script type="text/javascript">
    // Use "safe" template tag to prevent location string encoding
    var latitude = parseFloat("{{ station.latitude }}");
    var longitude = parseFloat("{{ station.longitude }}");
    var siteCode = "{{ station.code }}"
    var markerPath = "{% static 'img/markers/marker-blue.png' %}"

    map.getView().setCenter(ol.proj.transform([longitude, latitude], 'EPSG:4326', 'EPSG:3857'));
    map.getView().setZoom(10);

    // Check if values are valid and add a marker to the map
    if (!isNaN(latitude) && !isNaN(longitude)) {
        var point = new ol.Feature({
            geometry: new ol.geom.Point(ol.proj.fromLonLat([longitude, latitude])),
            name: `Site code: ${siteCode}, latitude: ${latitude}, longitude: ${longitude}`
        });

        point.setStyle(new ol.style.Style({
            image: new ol.style.Icon(/** @type {olx.style.IconOptions} */({
                anchor: [0.5, 46],
                anchorXUnits: 'fraction',
                anchorYUnits: 'pixels',
                src: markerPath,
            }))
        }));
        vectorSource.addFeature(point);
    }
</script>
{% endblock %}