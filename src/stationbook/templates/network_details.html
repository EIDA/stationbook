{% extends 'base.html' %}
{% load static %}

{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/ol.css' %}" type="text/css">
<style>
  .map {
    height: 500px;
    width: 100%;
  }
</style>
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'networks' %}">Networks</a></li>
<li class="breadcrumb-item active">{{ network.code }}</li>
{% endblock %}

{% block content %}
<h1>Network details</h1>
<p><b>Network Code:</b> {{ network.code }}</p>
<p><b>Network Description:</b> {{ network.description }}</p>
<p><b>Network Start Date:</b> {{ network.start_date }}</p>
<p><b>Network Restricted Status:</b> {{ network.restricted_status }}</p>

<div id="map" class="map">
  <div id="popup"></div>
</div>
<script src="{% static 'js/ol.js' %}"></script>
<script src="{% static 'js/home_openlayers.js' %}"></script>

<h1>List of stations</h1>
<table class="table">
    <thead class="thead-inverse">
        <tr>
            <th>Station code</th>
            <th>Site name</th>
            <th>Start date</th>
        </tr>
    </thead>
    <tbody>
        {% for station in network.fdsn_stations.all %}
        <tr>
            <td>
                <a href="{% url 'station_details' station.fdsn_network.code station.code %}">{{ station.code }}</a>
                <small class="text-muted d-block">
                    Latitude: {{ station.latitude }}, Longitude: {{ station.longitude }}
                </small>
            </td>
            <td>
                {{ station.site_name }}
            </td>
            <td>
                {{ station.start_date }}
            </td>
        </tr>
        <script type="text/javascript">
            // Use "safe" template tag to prevent location string encoding
            var latitude = parseFloat("{{ station.latitude }}");
            var longitude = parseFloat("{{ station.longitude }}");
            var siteCode = "{{ station.code }}"
            var markerPath = "{% static 'img/markers/marker-blue.png' %}"
      
            // Check if values are valid and add a marker to the map
            if (!isNaN(latitude) && !isNaN(longitude)) {
              var point = new ol.Feature({
                geometry: new ol.geom.Point(ol.proj.fromLonLat([longitude, latitude])),
                name: `Site code: ${siteCode}, latitude: ${latitude}, longitude: ${longitude}`
              });
      
              point.setStyle(new ol.style.Style({
                image: new ol.style.Icon(/** @type {olx.style.IconOptions} */({
                  anchor: [0.5, 46],
                  anchorXUnits: 'fraction',
                  anchorYUnits: 'pixels',
                  src: markerPath,
                }))
              }));
              vectorSource.addFeature(point);
            }
          </script>
        {% endfor %}
    </tbody>
</table>

<script type="text/javascript">
    var latitude = parseFloat("{{ network.fdsn_stations.all.0.latitude }}");
    var longitude = parseFloat("{{ network.fdsn_stations.all.0.longitude }}");
    map.getView().setCenter(ol.proj.transform([longitude, latitude], 'EPSG:4326', 'EPSG:3857'));
    map.getView().setZoom(6);
</script>

{% endblock %}