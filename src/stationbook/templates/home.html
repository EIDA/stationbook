{% extends 'base.html' %} {% load static %} {% block stylesheet %}
<link rel="stylesheet" href="https://openlayers.org/en/v4.6.4/css/ol.css" type="text/css">
<style>
  .map {
    height: 500px;
    width: 100%;
  }
</style>
{% endblock %} {% block breadcrumb %}
<li class="breadcrumb-item active">Stations</li>
{% endblock %} {% block content %}

<div id="map" class="map">
  <div id="popup"></div>
</div>

<script src="{% static 'js/ol.js' %}"></script>
<script src="{% static 'js/home_openlayers.js' %}"></script>

<table class="table">
  <thead class="thead-inverse">
    <tr>
      <th>Station name</th>
      <th>Station description</th>
    </tr>
  </thead>
  <tbody>
    {% for site, location in stations.items %}
    <tr>
      <td>
        </a>{{ site }}</a>
      </td>
      <td>
        {% for key, value in location.items %}
        <small class="text-muted d-block">{{ key }} : {{ value }}</small>
        {% endfor %}
      </td>
    </tr>

    <script type="text/javascript">
      // Use "safe" template tag to prevent location string encoding
      var site_location = "{{ location|safe }}";
      var site_name = "{{ site|safe }}";
      console.log(site_name);

      // Location value is a string, so we need
      // to extract data from Python-like dictionary
      var site_location_split = site_location.split(',');
      var latitude = parseFloat(
        site_location_split[0].split(':')[1].replace("'", ''));
      var longitude = parseFloat(
        site_location_split[1].split(':')[1].replace("'", ''));

      // Check if values are valid and add a marker to the map
      if (!isNaN(latitude) && !isNaN(longitude)) {
        var point = new ol.Feature({
          geometry: new ol.geom.Point(ol.proj.fromLonLat([longitude, latitude])),
          name: site_name
        });

        point.setStyle(new ol.style.Style({
          image: new ol.style.Icon(/** @type {olx.style.IconOptions} */({
            anchor: [0.5, 46],
            anchorXUnits: 'fraction',
            anchorYUnits: 'pixels',
            src: '../static/img/marker-green.png',
          }))
        }));
        vectorSource.addFeature(point);
      }
    </script> {% endfor %}
  </tbody>
</table>
{% endblock %}